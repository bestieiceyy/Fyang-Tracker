<!DOCTYPE html>
<html>
<head>
  <title>Fyang Live Tracker</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 40px; }
    .box { font-size: 20px; padding: 20px; border-radius: 10px; background: #f0f0f0; display: inline-block; }
    .gap-green { color: green; font-weight: bold; }
    .gap-red { color: red; font-weight: bold; }
    .added { font-size: 16px; color: gray; }
  </style>
</head>
<body>
  <div class="box">
    <div id="time"></div>
    <div id="fyang"></div>
    <div id="will"></div>
    <div id="gap"></div>
  </div>

  <script>
    const POLL_URL = "https://polls.polldaddy.com/vote-js.php?p=15909793";

    let prevFyang = null;
    let prevWill = null;
    let prevDiff = null;

    async function fetchVotes() {
      try {
        let response = await fetch(POLL_URL);
        let text = await response.text();

        // Extract candidates + votes
        let matches = [...text.matchAll(/class="pds-answer-text"[^>]*>(.*?)<\/span>.*?\(([\d,]+)\s+votes\)/gs)];

        let fyang = null, will = null;
        for (let m of matches) {
          let name = m[1].trim().toUpperCase();
          let votes = parseInt(m[2].replace(/,/g, ''));
          if (name.includes("FYANG")) fyang = votes;
          if (name.includes("WILL ASHLEY")) will = votes;
        }

        if (fyang !== null && will !== null) {
          // Added since last update
          let fyangAdded = prevFyang !== null ? fyang - prevFyang : 0;
          let willAdded = prevWill !== null ? will - prevWill : 0;
          let diff = fyang - will;

          let diffAdded = prevDiff !== null ? diff - prevDiff : 0;

          prevFyang = fyang;
          prevWill = will;
          prevDiff = diff;

          // Timestamp
          document.getElementById("time").innerText = "⏱️ " + new Date().toLocaleTimeString();

          // Vote totals + added
          document.getElementById("fyang").innerHTML =
            `Fyang Smith: ${fyang.toLocaleString()} votes <span class="added">(+${fyangAdded.toLocaleString()})</span>`;
          document.getElementById("will").innerHTML =
            `Will Ashley: ${will.toLocaleString()} votes <span class="added">(+${willAdded.toLocaleString()})</span>`;

          // Format gap + diff change with colors
          let diffAddedStr = "";
          if (diffAdded > 0) {
            diffAddedStr = `<span class="gap-green">(+${diffAdded.toLocaleString()})</span>`;
          } else if (diffAdded < 0) {
            diffAddedStr = `<span class="gap-red">(${diffAdded.toLocaleString()})</span>`;
          } else {
            diffAddedStr = "(0)";
          }
          
          let gapText = "";
          if (diff > 0) {
            gapText = `Gap: ${diff.toLocaleString()} ${diffAddedStr} Fyang leading`;
          } else if (diff < 0) {
            gapText = `Gap: ${Math.abs(diff).toLocaleString()} ${diffAddedStr} Will leading`;
          } else {
            gapText = `Gap: 0 ${diffAddedStr} Tied`;
          }
          
          document.getElementById("gap").innerHTML = gapText;

        } else {
          document.getElementById("gap").innerText = "⚠️ Candidates not found";
        }

      } catch (err) {
        document.getElementById("gap").innerText = "⚠️ Fetch failed";
      }
    }

    fetchVotes();
    setInterval(fetchVotes, 1000); // update every second
  </script>
</body>
</html>
